upstream backend {
  server backend:7000;
}
upstream frontend {
  server frontend:5000;
}

server {
  listen 80;
  root   /usr/share/nginx/html; #nginx www 기본폴더임 운영환경에 맞게 추후 수정
  index  index.html;

  # 서브디렉토리를 설정하였을 경우 rewrite 적용하여 경로 이동
  location / {
    # 80 포트로 / 접속을 하는 경우 web 으로 리다이렉트한다.
    rewrite ^(.+)$ /vueapp2/index.html last;
  }
  # 서브디렉토리 미설정시 직접 접근
  # location / {
  #   # 80 포트로 / 접속을 하는 경우 web 으로 리다이렉트한다.
  #   try_files $uri $uri/ @vueapp;
  # }

  # 리버스 프록시 설정
  location @vueapp {
    proxy_pass http://frontend;
  }

  # 서브디렉토리 구성시 프록시
  location /vueapp2/ {
    try_files $uri $uri/ @vueapp;
  }

  # API - SPRING BOOT로 올린 프록시 설정
  location /api/ {
    proxy_pass http://backend/api/;
    proxy_redirect off;
    charset utf-8;
    proxy_set_header X-Real-IP $remote_addr; 
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
  }

}